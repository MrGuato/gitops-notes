---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const base = import.meta.env.BASE_URL.replace(/\/$/, ""); // <-- removes trailing slash if present
const posts = (await getCollection("posts")).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout title="GitOps Notes">
  <section class="hero">
    <h1>Security Engineer’s Build Log</h1>
    <p>Building. Breaking. Fixing. Securing. Learning — one post at a time.</p>
    <div class="badges">
      <span class="badge">Weekly</span>
      <span class="badge">GitHub Pages</span>
      <span class="badge">Markdown</span>
    </div>
  </section>
  
  <section class="grid">
  {posts.map((p) => (
    <a class="card" href={`${base}/writing/${p.slug}`}>
      <div class="card-body">
        <div class="meta">
          {p.data.date.toLocaleDateString("en-US", { year: "numeric", month: "short", day: "numeric" })}
        </div>
        <h2>{p.data.title}</h2>
        <p>{p.data.description}</p>
      </div>

      {p.data.hero && <img class="thumb" src={`${base}/${p.data.hero}`} alt="" loading="lazy" />}
    </a>
  ))}
</section>
</BaseLayout>